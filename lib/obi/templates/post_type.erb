<?php
function create_<%= project_name[0..9] %>_<%= post_type.singularize %>_post_type() {
	// Setup Custom Post Type
	register_post_type(
		'<%= project_name[0..9] %>-<%= post_type.pluralize %>',
		array(
			'labels'	=> array(
							'name'                   => _x( '<%= post_type.pluralize.capitalize %>', 'taxonomy general name' ),
							'singular_name'          => _x( '<%= post_type.singularize.capitalize %>', 'taxonomy singular name' ),
							'menu_name'              => __( '<%= post_type.pluralize.capitalize %>' ),
							'all_items'              => __( 'All <%= post_type.pluralize.capitalize %>' ),
							'add_new'                => __( 'Add New <%= post_type.singularize.capitalize %>' ),
							'add_new_item'           => __( 'Add New <%= post_type.singularize.capitalize %>' ),
							'edit_item'              => __( 'Edit <%= post_type.singularize.capitalize %>' ),
							'new_item'               => __( 'New <%= post_type.singularize.capitalize %>' ),
							'view_item'              => __( 'View <%= post_type.singularize.capitalize %>' ),
							'search_items'           => __( 'Search <%= post_type.pluralize.capitalize %>' ),
							'not_found'              => __( 'No <%= post_type.pluralize %> found.' ),
							'not_found_in_trash'     => __( 'No <%= post_type.pluralize %> found in trash.' ),
							'parent_item'            => null,
			),
			'description'            => '',
			'has_archive'            => true,
			'public'                 => true,
			//'show_ui'              => true,
			//'show_in_menu'         => true,
			//'capability_type'      => 'post',
			'hierarchical'           => false,
			// 'exclude_from_search' => false,
			'supports'	=> array(
								'title',
								'editor',
								'author',
								'excerpt',
								'trackbacks',
								'comments',
								'revisions',
								'page-attributes',
								'thumbnail'
			),
			'rewrite'	=> array(
								'slug'	=> '<%= post_type.pluralize %>'
			)
		)
	);
}
add_action( 'init', 'create_<%= @project_name[0..9] %>_<%= post_type.singularize %>_post_type' );

function <%= post_type %>_type_init() {
	// Setup Custom Taxonomy
	register_taxonomy(
		'<%= post_type.singularize %>-type',
		array( '<%= project_name[0..9] %>-<%= post_type %>' ),
		array(
			'labels'	=> array(
								'name'                       => _x( '<%= post_type.pluralize.capitalize %>', 'taxonomy general name' ),
								'singular_name'              => _x( '<%= post_type.singularize.capitalize %>', 'taxonomy singular name' ),
								'menu_name'                  => __( '<%= post_type.pluralize.capitalize %> Types' ),
								'all_items'                  => __( 'All <%= post_type.pluralize.capitalize %>' ),
								'edit_item'                  => __( 'Edit <%= post_type.singularize.capitalize %>' ),
								'view_item'                  => __( 'View <%= post_type.singularize.capitalize %>' ),
								'update_item'                => __( 'Update <%= post_type.singularize.capitalize %>' ),
								'add_new_item'               => __( 'Add New <%= post_type.singularize.capitalize %>' ),
								'parent_item'                => null,
								'parent_item_colon'          => null,
								'search_items'               => __( 'Search <%= post_type.pluralize.capitalize %>' ),
								'popular_items'              => __( 'Popular <%= post_type.pluralize.capitalize %>' ),
								'separate_items_with_commas' => __( 'Separate <%= post_type.pluralize.capitalize %> with commas' ),
								'add_or_remove_items'        => __( 'Add or remove <%= post_type.singularize %>' ),
								'choose_from_most_used'      => __( 'Choose from the most used <%= post_type.singularize %>' ),
								'not_found'                  => __( 'No <%= post_type.pluralize.capitalize %> found.' ),
			),
			'hierarchical'               => true,
			'show_ui'                    => true,
			'query_var'                  => true,
			'rewrite'	=> array(
								'slug'            => '<%= post_type.singularize %>-type',
								// 'hierarchical' => true
			)
		)
	);
}
add_action( 'init', '<%= post_type.singularize %>_type_init' );

// remove_post_type_support('<%= @project_name %>-<%= post_type.pluralize %>', '');

function <%= post_type.pluralize %>_add_rewrite_rules($aRules) {
	$aNewRules = array('<%= post_type.singularize %>-type/([^/]*)/?$' => 'index.php?<%= post_type.singularize %>-type=$matches[1]');
	$aNewRules2  = array('<%= post_type.pluralize %>/<%= @filter_by_regexp %>' => 'index.php?post_type=<%= @project_name %>-<%= post_type.pluralize %><%= @filter_by %>');
	$aNewRules1 = array('<%= post_type.singularize %>-type/([^/]*)/<%= @filter_by_regexp %>' => 'index.php?<%= post_type.singularize %>-type<%= @taxonomy_filter_by %>');
	$aRules     = $aNewRules + $aNewRules1 + $aNewRules2 + $aRules;
	return $aRules;
}

// hook add_rewrite_rules function into rewrite_rules_array
add_filter('rewrite_rules_array', '<%= post_type.pluralize %>_add_rewrite_rules');

?>